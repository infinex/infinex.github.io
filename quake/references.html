http://projects.delimited.io/experiments/hexbins/starbucks-noclamp.html
<html><head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/leaflet.css">
    <style>
        body {
            background-image:url('css/dark.png');
            font-size: 12px;
        }
        text {
            fill: grey;
        }
        #mapContainer {
            margin: 100px;
            background-color: #333;
            width: 80%;
            height: 600px;
        }
        #tooltip {
            opacity: 1;
            background: #333;
            padding: 5px;
            border: 1px solid lightgrey;
            border-radius: 5px;
            position: absolute;
            z-index: 10;
            visibility: hidden;
            pointer-events: none;
        }
    </style>
    <script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-45101494-1']);
    _gaq.push(['_setDomainName', 'delimited.io']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
</head>
<body>
<div id="mapContainer" class="leaflet-container leaflet-fade-anim" tabindex="0" style="position: relative;"><div class="leaflet-map-pane" style="-webkit-transform: translate3d(0px, 0px, 0px);"><div class="leaflet-tile-pane"><div class="leaflet-layer"><div class="leaflet-tile-container"></div><div class="leaflet-tile-container leaflet-zoom-animated"><img class="leaflet-tile leaflet-tile-loaded" src="http://c.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/604/769.png" style="height: 256px; width: 256px; left: 473px; top: 17px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://a.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/604/770.png" style="height: 256px; width: 256px; left: 473px; top: 273px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://b.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/603/769.png" style="height: 256px; width: 256px; left: 217px; top: 17px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://a.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/605/769.png" style="height: 256px; width: 256px; left: 729px; top: 17px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://c.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/603/770.png" style="height: 256px; width: 256px; left: 217px; top: 273px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://b.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/605/770.png" style="height: 256px; width: 256px; left: 729px; top: 273px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://b.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/604/771.png" style="height: 256px; width: 256px; left: 473px; top: 529px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://b.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/604/768.png" style="height: 256px; width: 256px; left: 473px; top: -239px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://a.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/603/768.png" style="height: 256px; width: 256px; left: 217px; top: -239px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://c.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/605/768.png" style="height: 256px; width: 256px; left: 729px; top: -239px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://a.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/603/771.png" style="height: 256px; width: 256px; left: 217px; top: 529px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://c.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/605/771.png" style="height: 256px; width: 256px; left: 729px; top: 529px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://c.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/606/770.png" style="height: 256px; width: 256px; left: 985px; top: 273px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://b.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/606/769.png" style="height: 256px; width: 256px; left: 985px; top: 17px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://a.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/602/769.png" style="height: 256px; width: 256px; left: -39px; top: 17px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://b.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/602/770.png" style="height: 256px; width: 256px; left: -39px; top: 273px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://c.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/602/768.png" style="height: 256px; width: 256px; left: -39px; top: -239px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://a.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/606/768.png" style="height: 256px; width: 256px; left: 985px; top: -239px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://c.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/602/771.png" style="height: 256px; width: 256px; left: -39px; top: 529px;"><img class="leaflet-tile leaflet-tile-loaded" src="http://a.tile.cloudmade.com/201db536dac5474c9eed000778739c8e/82102/256/11/606/771.png" style="height: 256px; width: 256px; left: 985px; top: 529px;"></div></div></div><div class="leaflet-objects-pane"><div class="leaflet-shadow-pane"></div><div class="leaflet-overlay-pane"><svg id="hex-svg" class="leaflet-layer leaflet-zoom-hide" width="10617" height="9051" style="margin-left: -7653px; margin-top: -8309px;"><g class="zoom-11"></g></svg></div><div class="leaflet-marker-pane"></div><div class="leaflet-popup-pane"></div></div></div><div class="leaflet-control-container"><div class="leaflet-top leaflet-left"><div class="leaflet-control-zoom leaflet-bar leaflet-control"><a class="leaflet-control-zoom-in" href="#" title="Zoom in">+</a><a class="leaflet-control-zoom-out" href="#" title="Zoom out">-</a></div></div><div class="leaflet-top leaflet-right"></div><div class="leaflet-bottom leaflet-left"></div><div class="leaflet-bottom leaflet-right"><div class="leaflet-control-attribution leaflet-control"><a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> | © 2013 OpenStreetMap © 2013 CloudMade</div></div></div></div>
<div id="tooltip">
    <svg width="100px" height="100px"></svg>
</div>
<script src="../common/d3.js"></script>
<script src="../common/hexbin.js"></script>
<script src="../common/simple_statistics.js"></script>
<script src="../common/leaflet.js"></script>
<script>
    //**********************************************************************************
    //********  LEAFLET HEXBIN LAYER CLASS *********************************************
    //**********************************************************************************
    L.HexbinLayer = L.Class.extend({
        includes: L.Mixin.Events,
        initialize: function (rawData, options) {
            this.levels = {};
            this.layout = d3.hexbin().radius(10);
            this.rscale = d3.scale.sqrt().range([0, 10]).clamp(false);
            this.rwData = rawData;
            this.config = options;
        },
        project: function(x) {
            var point = this.map.latLngToLayerPoint([x[1], x[0]]);
            return [point.x, point.y];
        },
        getBounds: function(d) {
            var b = d3.geo.bounds(d)
            return L.bounds(this.project([b[0][0], b[1][1]]), this.project([b[1][0], b[0][1]]));
        },
        update: function () {
            var pad = 100, xy = this.getBounds(this.rwData), zoom = this.map.getZoom();

            this.container
                    .attr("width", xy.getSize().x + (2 * pad))
                    .attr("height", xy.getSize().y + (2 * pad))
                    .style("margin-left", (xy.min.x - pad) + "px")
                    .style("margin-top", (xy.min.y - pad) + "px");

            if (!(zoom in this.levels)) {
                this.levels[zoom] = this.container.append("g").attr("class", "zoom-" + zoom);
                this.genHexagons(this.levels[zoom]);
                this.levels[zoom].attr("transform", "translate(" + -(xy.min.x - pad) + "," + -(xy.min.y - pad) + ")");
            }
            if (this.curLevel) {
                this.curLevel.style("display", "none");
            }
            this.curLevel = this.levels[zoom];
            this.curLevel.style("display", "inline");
        },
        genHexagons: function (container) {
            var data = this.rwData.features.map(function (d) {
                var coords = this.project(d.geometry.coordinates)
                return [coords[0],coords[1], d.properties];
            }, this);

            var bins = this.layout(data);
            var hexagons = container.selectAll(".hexagon").data(bins);

            var counts = [];
            bins.map(function (elem) { counts.push(elem.length) });
            this.rscale.domain([0, (ss.mean(counts) + (ss.standard_deviation(counts) * 10))]);

            var path = hexagons.enter().append("path").attr("class", "hexagon");
            this.config.style.call(this, path);

            that = this;
            hexagons
                    .attr("d", function(d) { return that.layout.hexagon(that.rscale(d.length)); })
                    .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
                    .on("mouseover", function (d) {
                        var s=0, k=0;
                        d.map(function(e){
                            if (e.length === 3) e[2].group === 1 ? ++k : ++s;
                        });
                        that.config.mouse.call(this, [s,k]);
                        d3.select("#tooltip")
                                .style("visibility", "visible")
                                .style("top", function () { return (d3.event.pageY - 130)+"px"})
                                .style("left", function () { return (d3.event.pageX - 130)+"px";})
                    })
                    .on("mouseout", function (d) { d3.select("#tooltip").style("visibility", "hidden") });
        },
        addTo: function (map) {
            map.addLayer(this);
            return this;
        },
        onAdd: function (map) {
            this.map = map;
            var overlayPane = this.map.getPanes().overlayPane;

            if (!this.container || overlayPane.empty) {
                this.container = d3.select(overlayPane)
                        .append('svg')
                        .attr("id", "hex-svg")
                        .attr('class', 'leaflet-layer leaflet-zoom-hide');
            }
            map.on({ 'moveend': this.update }, this);
            this.update();
        }
    });

    L.hexbinLayer = function (data, styleFunction) {
        return new L.HexbinLayer(data, styleFunction);
    };
    //**********************************************************************************
    //********  IMPORT DATA AND REFORMAT ***********************************************
    //**********************************************************************************
    d3.csv('data/coffee.csv', function (error, coffee) {

        function reformat (array) {
            var data = [];
            array.map(function (d){
                data.push({
                    properties: {
                        group: +d.group,
                        city: d.city,
                        state: d.state,
                        store: d.storenumber
                    },
                    type: "Feature",
                    geometry: {
                        coordinates:[+d.longitude,+d.latitude],
                        type:"Point"
                    }
                });
            });
            return data;
        }
        var geoData = { type: "FeatureCollection", features: reformat(coffee) };
        //**********************************************************************************
        //********  CREATE LEAFLET MAP *****************************************************
        //**********************************************************************************
        var cscale = d3.scale.linear().domain([0,1]).range(["#00FF00","#FFA500"]);
        var leafletMap = L.map('mapContainer').setView([40.7, -73.8], 11);

        L.tileLayer('http://{s}.tile.cloudmade.com/{key}/{styleId}/256/{z}/{x}/{y}.png', {
            attribution: '&copy; 2013 OpenStreetMap &copy; 2013 CloudMade',
            key: '201db536dac5474c9eed000778739c8e',//Please don't use my key. It's free!!!
            styleId:82102  //82102  108996          //Go to www.cloudmade.com to get a key.
        }).addTo(leafletMap);
        //**********************************************************************************
        //********  ADD HEXBIN LAYER TO MAP AND DEFINE HEXBIN STYLE FUNCTION ***************
        //**********************************************************************************
        var hexLayer = L.hexbinLayer(geoData, {
            style: hexbinStyle,
            mouse: makePie
        }).addTo(leafletMap);

        function hexbinStyle(hexagons) {
            hexagons
                    .attr("stroke", "black")
                    .attr("fill", function (d) {
                        var values = d.map(function (elem) {
                            return elem[2].group;
                        })
                        var avg = d3.mean(d, function(d) { return +d[2].group; })
                        return cscale(avg);
                    });
        }

        //**********************************************************************************
        //********  PIE CHART ROLL-OVER ****************************************************
        //**********************************************************************************
        function makePie (data) {

            d3.select("#tooltip").selectAll(".arc").remove()
            d3.select("#tooltip").selectAll(".pie").remove()

            var arc = d3.svg.arc()
                    .outerRadius(45)
                    .innerRadius(10);

            var pie = d3.layout.pie()
                    .value(function(d) { return d; });

            var svg = d3.select("#tooltip").select("svg")
                    .append("g")
                    .attr("class", "pie")
                    .attr("transform", "translate(50,50)");

            var g = svg.selectAll(".arc")
                    .data(pie(data))
                    .enter().append("g")
                    .attr("class", "arc");

            g.append("path")
                    .attr("d", arc)
                    .style("fill", function(d, i) { return i === 1 ? "#FFA500":"#00FF00"; });

            g.append("text")
                    .attr("transform", function(d) { return "translate(" + arc.centroid(d) + ")"; })
                    .style("text-anchor", "middle")
                    .text(function (d) { return d.value === 0 ? "" : d.value; });
        }
    });
</script>

</body></html>